<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduMate - AI Study Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        .typing-animation::after {
            content: '|';
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Header -->
    <header class="glass-effect p-4 shadow-lg">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <i class="fas fa-graduation-cap text-3xl text-white"></i>
                <h1 class="text-2xl font-bold text-white">EduMate</h1>
            </div>
            <div class="text-white text-sm">
              <h1 class="text-xl"> AI Study Buddy </h1></b>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto p-6">
        <!-- Upload Section -->
        <div class="glass-effect rounded-xl p-6 mb-6">
            <h2 class="text-l font-semibold text-white mb-4 flex items-center">
                <i class="fas fa-upload mr-2"></i>
                Upload Document
            </h2>
            <div class="border-2 border-dashed border-white/80 rounded-lg p-1 text-center">
                <input type="file" id="fileInput" accept=".pdf,.txt" class="hidden" onchange="handleFileUpload(event)">
                <label for="fileInput" class="cursor-pointer">
                    <i class="fas fa-cloud-upload-alt text-4xl text-white/70 mb-4"></i>
                    <p class="text-white/80">Click to upload or drag & drop</p>
                    <p class="text-white/60 text-sm mt-2">(PDF or TXT files only)</p>
                </label>
            </div>
            <div id="uploadStatus" class="mt-4 text-white/80"></div>
        </div>

        <!-- Content Display -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Extracted Text -->
            <div class="glass-effect rounded-xl p-6">
                <h3 class="text-lg font-semibold text-white mb-3  flex items-center">
                    <i class="fas fa-file-text mr-1"></i>
                    Extracted Text
                </h3>
                <textarea id="extractedText" 
    class="w-full h-64 p-4 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 resize-none" 
    placeholder="Your document text will appear here..."
    disabled></textarea>

            </div>

            <!-- Features Tabs -->
            <div class="glass-effect rounded-xl p-2">
                <div class="flex space-x-1 mb-4">
                    <button onclick="switchTab('summarize')" id="summarizeTab" class="flex-1 py-2  px-1 rounded-lg bg-white/20 text-white font-medium ">
                        <i class="fas fa-compress-alt mr-2"></i>Summarize
                    </button>
                    <button onclick="switchTab('quiz')" id="quizTab" class="flex-1 py-2 px-4 rounded-lg bg-white/10 text-white/70 font-medium ">
                        <i class="fas fa-question-circle mr-2"></i>Quiz
                    </button>
                    <button onclick="switchTab('doubt')" id="doubtTab" class="flex-1 py-2 px-4 rounded-lg bg-white/10 text-white/70 font-medium ">
                        <i class="fas fa-question mr-2"></i>Ask Doubt
                    </button>
                </div>

                <!-- Summarize Tab -->
                <div id="summarizeContent" class="tab-content">
                    <button onclick="summarizeText()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors">
                        <i class="fas fa-magic mr-2"></i>Generate Summary
                    </button>
                    <div id="summaryResult" class="mt-4 p-4 bg-white/10 rounded-lg text-white hidden"></div>
                </div>

                <!-- Quiz Tab -->
                <div id="quizContent" class="tab-content hidden">
                    <button onclick="generateQuiz()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors">
                        <i class="fas fa-brain mr-2"></i>Generate Quiz
                    </button>
                    <div id="quizResult" class="mt-4 space-y-4"></div>
                </div>

                <!-- Ask Doubt Tab -->
                <div id="doubtContent" class="tab-content hidden">
                    <button onclick="openDoubtModal()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg transition-colors">
                        <i class="fas fa-comments mr-2"></i>Ask a Question
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Box -->
        <div class="glass-effect rounded-xl p-6 mt-6">
            <h3 class="text-lg font-semibold text-white mb-3 flex items-center">
                <i class="fas fa-robot mr-2"></i>
                CodeMentor Chatbot
            </h3>
            <div id="chatMessages" class="h-64 overflow-y-auto space-y-3 mb-4 p-4 bg-white/10 rounded-lg"></div>
            <div class="flex space-x-2">
                <input type="text" id="chatInput" placeholder="Ask anything..." class="flex-1 p-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50">
                <button onclick="sendChatMessage()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-lg transition-colors">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- Doubt Modal -->
    <div id="doubtModal" class="modal-backdrop fixed inset-0 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass-effect rounded-xl p-6 max-w-md w-full slide-in">
                <h3 class="text-xl font-semibold text-white mb-4">Ask Your Doubt</h3>
                <textarea id="doubtInput" class="w-full h-32 p-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 resize-none" placeholder="Type your question here..."></textarea>
                <div class="flex space-x-2 mt-4">
                    <button onclick="askDoubt()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors">
                        Submit
                    </button>
                    <button onclick="closeDoubtModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentText = '';
        let currentQuiz = [];

        // File Upload
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            document.getElementById('uploadStatus').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';

            try {
                const response = await fetch('/edumate/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.error) {
                    document.getElementById('uploadStatus').innerHTML = `<span class="text-red-300">${data.error}</span>`;
                } else {
                    currentText = data.extractedText;
                    document.getElementById('extractedText').value = currentText;
                    document.getElementById('uploadStatus').innerHTML = '<span class="text-green-300"><i class="fas fa-check mr-2"></i>File processed successfully!</span>';
                }
            } catch (error) {
                document.getElementById('uploadStatus').innerHTML = `<span class="text-red-300">Error: ${error.message}</span>`;
            }
        }

        // Tab Switching
        function switchTab(tab) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.querySelectorAll('[id$="Tab"]').forEach(tabBtn => {
                tabBtn.className = 'flex-1 py-2 px-4 rounded-lg bg-white/10 text-white/70 font-medium transition-all';
            });

            // Show selected tab content
            document.getElementById(tab + 'Content').classList.remove('hidden');
            document.getElementById(tab + 'Tab').className = 'flex-1 py-2 px-4 rounded-lg bg-white/20 text-white font-medium transition-all';
        }

        // Summarize Text
        async function summarizeText() {
            if (!currentText) {
                alert('Please upload a document first!');
                return;
            }

            document.getElementById('summaryResult').classList.remove('hidden');
            document.getElementById('summaryResult').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating summary...';

            try {
                const response = await fetch('/edumate/summarize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: currentText })
                });
                const data = await response.json();
                document.getElementById('summaryResult').innerHTML = data.summary;
            } catch (error) {
                document.getElementById('summaryResult').innerHTML = `<span class="text-red-300">Error: ${error.message}</span>`;
            }
        }

        // Generate Quiz
        async function generateQuiz() {
            if (!currentText) {
                alert('Please upload a document first!');
                return;
            }

            document.getElementById('quizResult').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating quiz...';

            try {
                const response = await fetch('/edumate/generateQuiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: currentText })
                });
                const data = await response.json();
                displayQuiz(data.quiz);
            } catch (error) {
                document.getElementById('quizResult').innerHTML = `<span class="text-red-300">Error: ${error.message}</span>`;
            }
        }

        function displayQuiz(quiz) {
            currentQuiz = quiz;
            let html = '';
            quiz.forEach((q, index) => {
                html += `
                    <div class="p-4 bg-white/10 rounded-lg">
                        <p class="text-white mb-3">${index + 1}. ${q.question}</p>
                        <div class="space-y-2">
                            ${q.options.map((option, optIndex) => `
                                <label class="flex items-center text-white/80">
                                    <input type="radio" name="q${index}" value="${optIndex}" class="mr-2">
                                    ${option}
                                </label>
                            `).join('')}
                        </div>
                        <button onclick="checkAnswer(${index})" class="mt-3 bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">
                            Check Answer
                        </button>
                        <div id="answer${index}" class="mt-2 text-sm hidden"></div>
                    </div>
                `;
            });
            document.getElementById('quizResult').innerHTML = html;
        }

        function checkAnswer(questionIndex) {
            const selected = document.querySelector(`input[name="q${questionIndex}"]:checked`);
            if (!selected) {
                alert('Please select an answer!');
                return;
            }

            const answerDiv = document.getElementById(`answer${questionIndex}`);
            const isCorrect = parseInt(selected.value) === currentQuiz[questionIndex].correctAnswer;
            
            answerDiv.className = `mt-2 text-sm ${isCorrect ? 'text-green-300' : 'text-red-300'}`;
            answerDiv.innerHTML = isCorrect ? 
                '<i class="fas fa-check mr-1"></i>Correct!' : 
                `<i class="fas fa-times mr-1"></i>Incorrect. ${currentQuiz[questionIndex].explanation}`;
            answerDiv.classList.remove('hidden');
        }

        // Doubt Modal
        function openDoubtModal() {
            document.getElementById('doubtModal').classList.remove('hidden');
        }

        function closeDoubtModal() {
            document.getElementById('doubtModal').classList.add('hidden');
            document.getElementById('doubtInput').value = '';
        }

        async function askDoubt() {
            const doubt = document.getElementById('doubtInput').value.trim();
            if (!doubt) return;

            try {
                const response = await fetch('/edumate/askDoubt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ doubt, context: currentText })
                });
                const data = await response.json();
                
                addChatMessage('user', doubt);
                addChatMessage('bot', data.answer);
                closeDoubtModal();
            } catch (error) {
                alert('Error asking doubt: ' + error.message);
            }
        }

        // Chat
        function addChatMessage(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            messageDiv.innerHTML = `
                <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${sender === 'user' ? 'bg-blue-500 text-white' : 'bg-white/20 text-white'}">
                    ${message}
                </div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage('user', message);
            input.value = '';

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ user_input: message })
                });
                const data = await response.json();
                addChatMessage('bot', data.response);
            } catch (error) {
                addChatMessage('bot', 'Error: ' + error.message);
            }
        }

        // Enter key support
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendChatMessage();
        });

        // Drag and drop support
        const dropZone = document.querySelector('label[for="fileInput"]').parentElement;
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropZone.classList.add('border-white/50');
        }

        function unhighlight() {
            dropZone.classList.remove('border-white/50');
        }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            document.getElementById('fileInput').files = files;
            handleFileUpload({ target: { files } });
        }
    </script>
</body>
</html>
